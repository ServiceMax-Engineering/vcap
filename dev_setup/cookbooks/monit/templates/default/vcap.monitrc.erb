<% node[:monit][:vcap_daemons].each do |name| %>
check process <%= name %> with pidfile /var/run/<%= name %>.pid
       group vcap_daemons
       start program = "/etc/init.d/<%= name %> start"
       stop program  = "/etc/init.d/<%= name %> stop"

<% end %>
<% node[:monit][:vcap_components].each do |name| %>
check process <%= name %> with pidfile /var/vcap/sys/run/<%= name %>.pid
       group vcap
       start program = "<%= node[:monit][:vcap_exec] %> start <%= name %>"
             as uid <%= node[:deployment][:user] %> and with gid <%= node[:deployment][:group] %>
       stop program = "<%= node[:monit][:vcap_exec] %> stop <%= name %>"
             as uid <%= node[:deployment][:user] %> and with gid <%= node[:deployment][:group] %>
       <%= node[:monit][:depends_on][name].collect {|dep| "depends on #{dep}"}.join("\n") unless node[:monit][:depends_on][name].nil? %>

<% end %>
